echo "======================================="

set -e

sudo rm -rf /etc/apache2/sites-available/rdtom.conf
sudo a2dissite rdtom

sudo cp tests/config/rdtom.conf /etc/apache2/sites-available
sudo a2ensite rdtom

sudo service apache2 restart
sudo service mysql restart

php codecept.phar run unit --steps
php codecept.phar run acceptance --steps

#./show_output

sudo service apache2 stop

if [ $# -gt 0  ]; then
	MESSAGE="$@"
	echo "Committing with message '$MESSAGE'"
	git pull
	git add -A
	git commit -am "$MESSAGE"
	git push
else
  echo "No commit message, no commit"
fi