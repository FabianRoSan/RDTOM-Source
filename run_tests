set -e

sudo ./copy_files_to_localhost

echo "Files copied to localhost"

sudo service apache2 restart
sudo service mysql restart

php codecept.phar run acceptance --steps --debug

for filename in tests/_output/*; do
    echo "\033[32;1m$filename\033[0m"
    cat "$filename"
    echo
done

sudo /etc/init.d/apache2 stop

if [ $# -gt 0  ]; then
	MESSAGE="$@"
	echo "Committing with message '$MESSAGE'"
	git pull
	git add -A
	git commit -am "$MESSAGE"
	git push
else
  echo "No commit message, no commit"
fi