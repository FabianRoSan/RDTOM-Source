machine:
  php:
    version: 5.4.4
  environment:
    ENVIRONMENT: development
  hosts:
    rdtom: 127.0.0.1

dependencies:
  post:
    - phantomjs --webdriver=4444 &
    - sudo a2enmod rewrite
    - sudo a2enmod headers
    - sudo cp ~/RDTOM-Source/tests/config/rdtom /etc/apache2/sites-available
    - sudo a2ensite rdtom
    - sudo service apache2 restart

database:
  override:
    - mysql -u ubuntu circle_test < tests/_data/dump.sql

test:
  post:
    - php codecept.phar run unit --steps
    - php codecept.phar run acceptance --steps --debug
    - ./show_output

deployment:
  master:
    branch: master
    commands:
      - ./deploy.sh